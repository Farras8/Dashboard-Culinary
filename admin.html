<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>AdminHub</title>
</head>
<body>

<!-- SIDEBAR -->
<section id="sidebar">
    <a href="#" class="brand">
        <span class="text">KING CULINARY</span>
    </a>
    <a href="" class="img-brand">
        <img src="img/King_Culinary_Logo-removebg-preview.png">
    </a>
    <ul class="side-menu top">
        <li>
            <a href="index.html" class="no-active">
                <i class='bx bxs-dashboard'></i>
                <span class="text">Dashboard</span>
            </a>
        </li>
        <li>
            <a href="categories.html" class="no-active">
                <i class='bx bxs-book-content'></i>
                <span class="text">Categories</span>
            </a>
        </li>
        <li>
            <a href="foodRecipe.html" class="no-active">
                <i class='bx bxs-food-menu'></i>
                <span class="text">Food Recipe</span>
            </a>
        </li>
        <li>
            <a href="comment.html" class="no-active">
                <i class='bx bxs-comment'></i>
                <span class="text">Comment</span>
            </a>
        </li>
        <li>
            <a href="user.html" class="no-active">
                <i class='bx bxs-user'></i>
                <span class="text">User</span>
            </a>
        </li>
        <li>
            <a href="admin.html" class="active">
                <i class='bx bxs-user-circle'></i>
                <span class="text">Admin</span>
            </a>
        </li>
    </ul>
    <ul class="side-menu">
        <li>
            <a href="login.html" class="logout">
                <i class='bx bx-log-in'></i>
                <span class="text">Logout</span>
            </a>
        </li>
    </ul>
</section>
<!-- SIDEBAR -->

<!-- CONTENT -->
<section id="content">
    <!-- NAVBAR -->
    <nav>
        <i class='bx bx-menu'></i>
        <input type="checkbox" id="switch-mode" hidden>
        <label for="switch-mode" class="switch-mode"></label>
        <div class="hiAdmin">
            <i class='bx bx-user'></i>
            <h6 class="AdminName">Admin</h6>
        </div>
    </nav>
    <!-- NAVBAR -->

    <!-- MAIN -->
    <main>
        <div class="head-title">
            <div class="left">
                <h1>Admin</h1>
                <ul class="breadcrumb">
                    <li>
                        <button type="button" class="add-btn" data-bs-toggle="modal" data-bs-target="#adminModalAdd">
                            Add Admin
                        </button>
                          
                        <!-- Modal Add -->
                        <div class="modal fade" id="adminModalAdd" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="adminModalLabel">Add Admin</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="admin-form">
                                            <div class="mb-3">
                                                <label for="admin-id" class="form-label">Admin ID</label>
                                                <input type="text" class="form-control" id="admin-id" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="username" class="form-label">Username</label>
                                                <input type="text" class="form-control" id="username" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="password" class="form-label">Password</label>
                                                <input type="password" class="form-control" id="password" required>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button id="buttonAdd" type="button" class="btn btn-primary">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modal Edit -->
                        <div class="modal fade" id="adminModalEdit" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="adminModalLabel">Edit Admin</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="admin-form-edit">
                                            <div class="mb-3">
                                                <label for="edit-admin-id" class="form-label">Admin ID</label>
                                                <input type="text" class="form-control" id="edit-admin-id" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="edit-username" class="form-label">Username</label>
                                                <input type="text" class="form-control" id="edit-username" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="edit-password" class="form-label">Password</label>
                                                <input type="password" class="form-control" id="edit-password" required>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button id="buttonEdit" type="button" class="btn btn-primary" onclick="editAdmin()">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="table-data">
            <div class="order">
                <div class="head">
                    <h3>Admin</h3>
                    <i class='bx bx-search'></i>
                    <i class='bx bx-filter'></i>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Admin ID</th>
                            <th>Username</th>
                            <th>Password</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    <!-- MAIN -->
</section>
<!-- CONTENT -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyA2fKRX50046RzWGn4vkgxrLudMabAABlA",
        authDomain: "kingculinarydb.firebaseapp.com",
        databaseURL: "https://kingculinarydb-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "kingculinarydb",
        storageBucket: "kingculinarydb.appspot.com",
        messagingSenderId: "1096190427358",
        appId: "1:1096190427358:web:e3a3e53b14d5b4e18f0d14"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Add admin
    document.getElementById("buttonAdd").addEventListener("click", function() {
        let adminId = document.getElementById("admin-id").value;
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;

        set(ref(database, "admin/" + adminId), {
            adminId: Number(adminId),
            username: username,
            password: password
        }).then(() => {
            // Data saved successfully
            alert("Admin Successfully Added!");
            getAllData(); // Refresh the table data
        }).catch((error) => {
            alert("Failed to add admin!");
            console.log(error);
        });

        // Close the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('adminModalAdd'));
        modal.hide();
    });

    // Update Admins
    document.getElementById("buttonEdit").addEventListener("click", function() {
        let adminId = document.getElementById("edit-admin-id").value;
        let username = document.getElementById("edit-username").value;
        let password = document.getElementById("edit-password").value;

        update(ref(database, "admin/" + adminId), {
            adminId: Number(adminId),
            username: username,
            password: password
        }).then(() => {
            // Data updated successfully
            alert("Admin Successfully Updated!");
            getAllData(); // Refresh the table data
        }).catch((error) => {
            alert("Failed to update admin!");
            console.log(error);
        });

        // Close the modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('adminModalEdit'));
        modal.hide();
    });

    // Delete Admin
    function deleteAdmin(adminId) {
        remove(ref(database, "admin/" + adminId)).then(() => {
            // Data deleted successfully
            alert("Admin Successfully Deleted!");
            getAllData(); // Refresh the table data
        }).catch((error) => {
            alert("Failed to delete admin!");
            console.log(error);
        });
    }

    // Add Admin Table Item
    function addAdminTableItem(adminId, username, password) {
        let trow = document.createElement("tr");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");

        td1.innerHTML = adminId;
        td2.innerHTML = username;
        td3.innerHTML = password;

        // Create the Edit button
        let editButton = document.createElement("button");
        editButton.innerHTML = "Edit";
        editButton.classList.add("btn-edit");
        editButton.setAttribute("data-bs-toggle", "modal");
        editButton.setAttribute("data-bs-target", "#adminModalEdit");
        editButton.onclick = function() {
            document.getElementById("edit-admin-id").value = adminId;
            document.getElementById("edit-username").value = username;
            document.getElementById("edit-password").value = password;
        };

        // Create the Delete button
        let deleteButton = document.createElement("button");
        deleteButton.innerHTML = "Delete";
        deleteButton.classList.add("btn-del");
        deleteButton.onclick = function() {
            if (confirm("Are you sure you want to delete this admin?")) {
                deleteAdmin(adminId); // Call delete function
                trow.remove(); // This line will remove the row from the table
            }
        };

        td4.appendChild(editButton);
        td4.appendChild(deleteButton);

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);

        document.getElementById("adminTableBody").appendChild(trow);
    }

    // Add All Admins to Table
    function addAllAdminTable(admin) {
        document.getElementById("adminTableBody").innerHTML = "";
        admin.forEach(element => {
            addAdminTableItem(element.adminId, element.username, element.password);
        });
    }

    // Fetch All Admins from Firebase
    function getAllData() {
        const dbref = ref(database);
        get(child(dbref, "admin")).then((snapshot) => {
            if (snapshot.exists()) {
                var admin = [];
                snapshot.forEach(childSnapshot => {
                    admin.push(childSnapshot.val());
                });
                addAllAdminTable(admin);
            } else {
                console.log("No data available");
            }
        }).catch((error) => {
            console.log(error);
        });
    }

    // Initialize Data Fetch
    window.onload = getAllData();
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const adminName = localStorage.getItem("adminUsername");
        if (adminName) {
            document.querySelector(".AdminName").textContent = adminName;
        } else {
            alert("No admin logged in.");
            window.location.href = "login.html";
        }
        document.querySelector(".logout").addEventListener("click", function() {
            localStorage.removeItem("adminUsername");
            window.location.href = "login.html";
        });
    });
</script>
</body>
</html>
